/* eslint-disable */
module.exports = {
name: "@yarnpkg/plugin-plugin-manager",
factory: function (require) {
var plugin;plugin=(()=>{var e={898:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>m});const r=require("clipanion"),a=require("@yarnpkg/core"),o=require("@yarnpkg/fslib"),s=require("child_process");var i=t(474),c=t.n(i);const p=async e=>{if(!Array.isArray(e))return u(e);for(const n of e){const e=await u(n);if(e)return e}return 0},u=async e=>{const{cwd:n,args:t,env:r=process.env}=e;return new Promise(e=>{(0,s.spawn)("yarn",t,{stdio:"inherit",cwd:o.npath.fromPortablePath(n),env:r}).on("exit",n=>e(n?1:0))})},l=(e,n)=>{const t=n.map(e=>e.toLowerCase()),r={};for(const[n,a]of Object.entries(e))t.includes(n.toLowerCase())||(r[n]=a);return r},f=async(e,n)=>{const t=[],r=/^\.yarn\/plugins\/plugin-manager\/node_modules\/(.+)\/bundles\/(.+)\.c?js$/,o=await(async e=>{const n=[];return await a.Configuration.updateConfiguration(e,e=>{if(Array.isArray(e.plugins))for(const t of e.plugins)n.push({path:(null==t?void 0:t.path)||t,spec:(null==t?void 0:t.spec)||t});return e}),n})(e);for(const{spec:a}of o){const o=a.match(r);if(o){const[,r,a]=o;r in n||t.push({cwd:e,args:["plugin","remove",a]})}}return t},d=async e=>{const n=o.ppath.join(e,".yarn/plugins/plugin-manager"),t=await(async e=>JSON.parse(await o.xfs.readFilePromise(o.ppath.join(e,"package.json"),"utf8")).dependencies||{})(n),r=await p(await f(e,t));return r||p(await(async(e,n)=>{const t=[],r=o.ppath.join(e,".yarn/plugins/plugin-manager");for(const s of Object.keys(n)){const n=a.structUtils.parseIdent(s),{name:i}=n;if(!i.startsWith("yarn-plugin-"))throw new Error('Package name does not start with "yarn-plugin-": '+a.structUtils.stringifyIdent(n));const p=i.slice("yarn-".length);let u;for(const e of[".js",".cjs"]){const t=`${p}${e}`,s=o.ppath.join(r,"node_modules",a.structUtils.stringifyIdent(n),"bundles/@yarnpkg",t);if(await o.xfs.existsPromise(s)){u=s;break}}if(!u)throw new Error("Bundle not found in package: "+a.structUtils.stringifyIdent(n));const l=o.npath.fromPortablePath(u),f=o.ppath.join(e,".yarn/plugins/@yarnpkg",p+".cjs");if(await o.xfs.existsPromise(f)){if(await c()(l)===await c()(o.npath.fromPortablePath(f)))return[]}t.push({cwd:e,args:["plugin","import",l]})}return t})(e,t))};var y=function(e,n,t,r){var a,o=arguments.length,s=o<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,n,t,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o<3?a(s):o>3?a(n,t,s):a(n,t))||s);return o>3&&s&&Object.defineProperty(n,t,s),s};class g extends r.Command{constructor(){super(...arguments),this.args=[]}async execute(){const e=await a.Configuration.find(this.context.cwd,this.context.plugins),{project:n}=await a.Project.find(e,this.context.cwd),t=n.cwd;await(async e=>{const n=o.ppath.join(e,".yarn/plugins/plugin-manager");await o.xfs.mkdirpPromise(n),await o.xfs.writeFilePromise(o.ppath.join(n,".gitignore"),"node_modules\n**/.yarn/*\n!**/.yarn/releases\n!**/.yarn/plugins\n!**/.yarn/sdks\n!**/.yarn/versions\n"),await o.xfs.writeFilePromise(o.ppath.join(n,".yarnrc.yml"),"lockfileFilename: yarn.lock\nnodeLinker: node-modules\n");const t=o.ppath.join(n,"package.json");await o.xfs.existsPromise(t)||await o.xfs.writeFilePromise(t,"{\n}\n");const r=o.ppath.join(n,"yarn.lock");await o.xfs.existsPromise(r)||await o.xfs.writeFilePromise(r,"\n")})(t);const r=await(async(e,n)=>{const t=o.ppath.join(e,".yarn/plugins/plugin-manager");return p({cwd:t,args:n,env:l(process.env,["YARN_RC_FILENAME","YARN_LOCKFILE_FILENAME","YARN_NODE_LINKER"])})})(t,this.args);return r||d(t)}}y([r.Command.Proxy()],g.prototype,"args",void 0),y([r.Command.Path("plugin-manager")],g.prototype,"execute",null);const m={commands:[g]}},474:(e,n,t)=>{const r=t(417),a=t(747);e.exports=function(e){return new Promise((n,t)=>{const o=r.createHash("md5"),s=a.createReadStream(e);s.on("error",e=>{t(e)}),o.once("readable",()=>{n(o.read().toString("hex"))}),s.pipe(o)})},e.exports.sync=function(e){const n=a.openSync(e,"r"),t=r.createHash("md5"),o=Buffer.alloc(8192);try{let e;do{e=a.readSync(n,o,0,8192),t.update(o.slice(0,e))}while(8192===e)}finally{a.closeSync(n)}return t.digest("hex")}},417:e=>{"use strict";e.exports=require("crypto")},747:e=>{"use strict";e.exports=require("fs")}},n={};function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{}};return e[r](a,a.exports,t),a.exports}return t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(898)})();
return plugin;
}
};